From d0398dfe837d3995f42ee43b4915f3f279253c1c Mon Sep 17 00:00:00 2001
From: Eik Binschek <binschek@dresearch-fe.de>
Date: Wed, 13 Jun 2012 10:17:23 +0200
Subject: [PATCH] kernel: BTMODE12 inverse

	use inverse BTMODE12 te select 16BIT nand flash

Signed-off-by: Eik Binschek <binschek@dresearch-fe.de>
---
 arch/arm/mach-omap2/board-ti8148evm.c |   15 +++++++++------
 1 files changed, 9 insertions(+), 6 deletions(-)

diff --git a/arch/arm/mach-omap2/board-ti8148evm.c b/arch/arm/mach-omap2/board-ti8148evm.c
index 779c2a4..582da6e 100644
--- a/arch/arm/mach-omap2/board-ti8148evm.c
+++ b/arch/arm/mach-omap2/board-ti8148evm.c
@@ -527,6 +527,7 @@ static void __init ti814x_hdmi_init(void)
 static void __init ti8148_evm_init(void)
 {
 	int bw; /* bus-width */
+	int ret=0;
 
 	ti814x_mux_init(board_mux);
 	omap_serial_init();
@@ -536,23 +537,25 @@ static void __init ti8148_evm_init(void)
 
 	omap2_hsmmc_init(mmc);
 
-	/* nand initialisation */
-#if 0
-# HidaV do not have a BTMODE BW pin on board
+	/* nand initialisation HidaV use inverse bw-PIN (EVM S1 BIT 8 has to be ON, if 16Bit flash is used.) 
+	*/
 	if (cpu_is_ti814x()) {
 
 		u32 *control_status = TI81XX_CTRL_REGADDR(0x40);
 		if (*control_status & (1<<16))
-			bw = 0; /*8-bit nand if BTMODE BW pin on board is ON*/
+			/* bw = 0; 8-bit nand if BTMODE BW pin on board is ON*/
+			bw = 2; /*16-bit nand if BTMODE BW pin on board is ON*/
 		else
-			bw = 2; /*16-bit nand if BTMODE BW pin on board is OFF*/
+			/*bw = 2; 16-bit nand if BTMODE BW pin on board is OFF*/
+			bw = 0; /*8-bit nand if BTMODE BW pin on board is  OFF*/
 
 		board_nand_init(ti814x_nand_partitions,
 			ARRAY_SIZE(ti814x_nand_partitions), 0, bw);
 	} else
-#endif
+	{
 		board_nand_init(ti814x_nand_partitions,
 		ARRAY_SIZE(ti814x_nand_partitions), 0, NAND_BUSWIDTH_16);
+	}
 
 	/* initialize usb */
 	usb_musb_init(&musb_board_data);
-- 
1.7.7

